<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <title>Work Hours Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <main>
      <header class="card">
        <div class="row">
          <div>
            <h1>Work Hours Tracker</h1>
            <p class="muted">
              Target: <strong><span id="targetLabel">4 h / day</span></strong>.
              Bank is computed from daily deltas (hours − target).
            </p>
          </div>
          <div class="spacer"></div>
          <img
            class="logo"
            alt="Logo"
            src="https://static.wixstatic.com/media/1a37a8_371b4c547bf749fea5456edd71552380~mv2.png/v1/fill/w_207,h_97,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/White%20and%20Blue%20Modern%20Data%20Analytics%20Services%20Facebook%20Cover%20(7).png"
          />
        </div>

        <div class="row" style="margin-top: 0.6rem">
          <div id="bankBadge" class="badge yellow">Loading…</div>
          <div id="bankScope" class="muted"></div>
          <div class="spacer"></div>

          <label class="row">
            <input id="excludeCurrentWeek" type="checkbox" checked />
            <span class="muted">Exclude current week from bank</span>
          </label>

          <label class="row">
            <span class="muted">Daily target (hours)</span>
            <input id="targetInput" type="number" min="0" step="0.25" value="4" style="width: 5rem" />
          </label>

          <button id="themeBtn" class="btn-ghost" type="button">Toggle theme</button>
          <button id="demoBtn" class="btn-ghost" type="button" title="Load a safe preview without touching real data">
            Run demo
          </button>
        </div>

        <div class="row playful-row">
          <div id="weatherStatus" class="weather-chip">Fetching your local vibes…</div>
          <div class="spacer"></div>
          <div id="secretHint" class="muted secret-hint">Hint: tap the title 5x for a cozy surprise.</div>
        </div>

        <div id="demoNotice" class="muted demo-note" style="display: none">
          Demo mode is on. Play freely—changes stay on this page only.
        </div>
      </header>

      <section id="loginArea" class="card" style="display: flex">
        <div class="row">
          <input id="passwordInput" type="password" placeholder="Enter password to edit" />
          <button id="unlockBtn" class="btn" type="button">Unlock editing</button>
        </div>
      </section>

      <section id="lockArea" class="card" style="display: none">
        <div class="row">
          <p>You are editing this tracker.</p>
          <div class="spacer"></div>
          <button id="lockBtn" class="btn" type="button">Lock editing</button>
        </div>
      </section>

      <section class="card">
        <h2>Quick timer</h2>
        <div class="row">
          <button id="timerBtn" class="btn" type="button">Start timer</button>
          <div id="timerStatus" style="font-size: 1.6rem">00:00:00</div>
          <button id="timerSaveBtn" class="btn" type="button" disabled>Stop &amp; save</button>
        </div>

        <div class="row" style="margin-top: 0.6rem">
          <label class="row">
            <span class="muted">Start</span>
            <input id="startTime" type="time" />
          </label>
          <label class="row">
            <span class="muted">End</span>
            <input id="endTime" type="time" />
          </label>
          <button id="addSessionBtn" class="btn" type="button">Add session</button>
        </div>
      </section>

      <section class="card" id="insightsCard">
        <div class="row">
          <h2>Insights &amp; focus</h2>
          <div class="spacer"></div>
          <button id="fillTargetBtn" class="btn-ghost" type="button">Fill blanks with target</button>
          <button id="clearWeekBtn" class="btn-ghost" type="button">Clear this week</button>
        </div>
        <p class="muted" style="margin-bottom: 0.4rem">Weekly goal progress</p>
        <div class="progress">
          <div
            id="weekProgressFill"
            class="progress-fill"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="0"
          ></div>
        </div>
        <div class="row" style="margin-top: 0.25rem">
          <span id="weekProgressLabel" class="muted">0h of 0h</span>
        </div>
        <div class="insight-grid" style="margin-top: 0.75rem">
          <div>
            <p class="muted">Current streak (meets target)</p>
            <p class="stat-value" id="currentStreakStat">0 days</p>
          </div>
          <div>
            <p class="muted">Best streak</p>
            <p class="stat-value" id="bestStreakStat">0 days</p>
          </div>
          <div>
            <p class="muted">Recorded weekday hours</p>
            <p class="stat-value" id="totalHoursStat">0 h</p>
          </div>
          <div>
            <p class="muted">Avg weekday</p>
            <p class="stat-value" id="avgDayStat">0 h</p>
          </div>
        </div>
        <p class="muted" id="bestDayStat" style="margin-top: 0.6rem">Best day: —</p>
      </section>

      <section class="card">
        <div class="row">
          <h2 id="currentTitle">This week</h2>
          <div class="spacer"></div>
          <button id="saveBtn" class="btn" type="button" disabled>Save changes</button>
        </div>
        <div id="weekGrid" class="grid-5" style="margin-top: 0.5rem"></div>
        <div class="row" style="margin-top: 0.6rem">
          <div>
            Worked this week: <strong><span id="weekHours">0</span> h</strong>
            <span id="weekDelta" class="muted"></span>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="row">
          <h2>Edit any month</h2>
          <div class="spacer"></div>
          <label class="row">
            <span class="muted">Month</span>
            <input id="monthPicker" type="month" />
          </label>
          <button id="saveMonthBtn" class="btn" type="button" disabled>Save month changes</button>
        </div>

        <table style="margin-top: 0.6rem">
          <thead>
            <tr>
              <th>Date</th>
              <th>Weekday</th>
              <th>Hours</th>
              <th>Δ vs target</th>
            </tr>
          </thead>
          <tbody id="monthBody">
            <tr><td colspan="4">Select a month.</td></tr>
          </tbody>
        </table>
      </section>

      <section class="card">
        <div class="row">
          <h2>History (daily-based → weekly rollups)</h2>
          <div class="spacer"></div>
          <button id="exportCsvBtn" class="btn" type="button">Export CSV</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Week</th>
              <th>Mon–Fri total</th>
              <th>Week Δ (Σ daily)</th>
              <th>Bank after week</th>
            </tr>
          </thead>
          <tbody id="historyBody">
            <tr><td colspan="4">Loading…</td></tr>
          </tbody>
        </table>
      </section>
    </main>

    <div id="fxLayer" aria-hidden="true"></div>

    <script type="module" src="./js/app.js"></script>
  </body>
</html>
